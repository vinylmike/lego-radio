<!DOCTYPE html>
<html>
<head>
    <title>Manage Stations</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body { background: #1a1a1a; color: #fff; font-family: Orbitron, sans-serif; padding: 2rem; }
        h1 { text-align: center; margin-bottom: 2rem; }
        .search-bar { text-align: center; margin-bottom: 2rem; }
        input[type="text"] {
            font-size: 1.2rem; padding: 0.5rem 1rem; width: 60%;
            border-radius: 12px; border: none;
        }
        .results, .presets {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 800px;
            margin: auto;
        }
        .station {
            display: flex; justify-content: space-between;
            align-items: center; background: #333; padding: 1rem;
            border-radius: 10px;
        }
        .station-info { flex: 1; }
        .station img { height: 32px; width: 32px; margin-right: 10px; }
        button { background: none; border: none; font-size: 1.5rem; color: #fff; cursor: pointer; }
        button:hover { color: #0f0; }
        .remove:hover { color: #f00; }
    </style>
</head>
<body>
    <h1>üîß Manage Your Radio Stations</h1>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search stations..." />
    </div>

    <h2 style="text-align:center">üîÅ Results</h2>
    <div class="results" id="searchResults"></div>

    <h2 style="text-align:center">üìª Presets</h2>
    <div class="presets" id="presetList"></div>

    <script>
        const searchInput = document.getElementById("searchInput");
        const resultsDiv = document.getElementById("searchResults");
        const presetList = document.getElementById("presetList");

        async function fetchPresets() {
            const res = await fetch("/api/presets");
            return await res.json();
        }

        async function loadPresets() {
            const presets = await fetchPresets();
            presetList.innerHTML = "";
            for (const p of presets) {
                const stationData = await fetch(`/api/search?q=${p.stationuuid}`).then(r => r.json());
                if (stationData.length === 0) continue;
                const s = stationData[0];
                const div = document.createElement("div");
                div.className = "station";
                div.innerHTML = `
                    <div class="station-info">
                        <img src="${s.favicon || ''}" onerror="this.src='https://radio-browser.info/assets/images/placeholder-station.png'">
                        ${s.name} ‚Äî ${s.country}
                    </div>
                    <button class="remove" onclick="removePreset('${s.stationuuid}')">üóëÔ∏è</button>
                `;
                presetList.appendChild(div);
            }
        }

        async function removePreset(uuid) {
            await fetch("/api/presets/remove", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ stationuuid: uuid })
            });
            loadPresets();
        }

        async function addPreset(uuid) {
            await fetch("/api/presets/add", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ stationuuid: uuid })
            });
            loadPresets();
        }

        searchInput.addEventListener("input", async () => {
            const q = searchInput.value;
            const res = await fetch(`/api/search?q=${q}`);
            const stations = await res.json();
            resultsDiv.innerHTML = "";
            for (const s of stations.slice(0, 10)) {
                const div = document.createElement("div");
                div.className = "station";
                div.innerHTML = `
                    <div class="station-info">
                        <img src="${s.favicon || ''}" onerror="this.src='https://radio-browser.info/assets/images/placeholder-station.png'">
                        ${s.name} ‚Äî ${s.country} (${s.bitrate}kbps)
                    </div>
                    <button onclick="addPreset('${s.stationuuid}')">‚ûï</button>
                `;
                resultsDiv.appendChild(div);
            }
        });

        loadPresets();
    </script>
</body>
</html>
